include .env
export $(sed 's/=.*//' .env)

#colors
ccred=\033[0;31m
ccgreen=\033[0;32m
ccyellow=\033[0;33m
ccend=\033[0m

all: clean build

checkconfig:
	@echo "${ccyellow}Checking env config ${ccend}"
	#Check & restore config here

build:autoconf
	@echo "${ccgreen}Starting build${ccend}"

	${CC} -g -c -fPIC -Wno-format ${SOURCE_DIR}/msg_parser.c -o ${BUILD_DIR}/msg_parser.o -I${INCLUDE_DIR}

	#pack dynamic lib
	#${CC} -g -shared -o ${BUILD_DIR}/msg_parser.so ${BUILD_DIR}/msg_parser.o
	
	#pack static lib
	${AR} rcs ${BUILD_DIR}/msg_parser.a ${BUILD_DIR}/msg_parser.o

	#build crc32 lib
	${CC} -g -c -fPIC -Wno-format ${SOURCE_DIR}/crc32.c -o ${BUILD_DIR}/crc32.o -I${INCLUDE_DIR}
	${AR} rcs ${BUILD_DIR}/crc32.a ${BUILD_DIR}/crc32.o

	#spice up  with headers
	cp ${INCLUDE_DIR}/msg_parser.h ${BUILD_DIR}/msg_parser.h
	cp ${INCLUDE_DIR}/crc32.h ${BUILD_DIR}/crc32.h
	cp ${INCLUDE_DIR}/autoconf.h ${BUILD_DIR}/autoconf.h

	@echo "${ccgreen}Build${ccend}"

autoconf:checkconfig
	@echo "/* Autogenerated content! Do not edit! */" > ./inc/autoconf.h
	@echo "#define DEBUG ${DEBUG}" >> ./inc/autoconf.h

clean:
	@echo "${ccyellow}Cleaning build dir ${ccend}"
	rm -rf ./bin/
	mkdir bin
